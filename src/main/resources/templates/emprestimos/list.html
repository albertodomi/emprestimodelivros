<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout (~{::title}, ~{::section})}">
<head>
    <title>Lista de Empréstimos</title>
</head>
<body>
    <section>
        <h1>Lista de Empréstimos</h1>
        <a th:href="@{/emprestimos/realizar-form}" class="btn btn-primary mb-3">Realizar Novo Empréstimo</a>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Código</th>
                    <th>Usuário</th>
                    <th>Livros</th>
                    <th>Data Empréstimo</th>
                    <th>Data Devolução</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="emprestimo : ${emprestimos}">
                    <td th:text="${emprestimo.codigo}"></td>
                    <td th:text="${emprestimo.usuario?.nome}"></td> <td>
                        <ul class="list-unstyled mb-0">
                            <li th:each="livro : ${emprestimo.livros}" th:text="${livro.titulo}"></li> </ul>
                    </td>
                    <td th:text="${#temporals.format(emprestimo.dataEmprestimo, 'dd/MM/yyyy')}"></td>
                    <td th:text="${emprestimo.dataDevolucao != null ? #temporals.format(emprestimo.dataDevolucao, 'dd/MM/yyyy') : 'Pendente'}"></td>
                    <td th:text="${emprestimo.status.toString()}"></td>
                    <td>
                        <a th:href="@{/emprestimos/editar/{id}(id=${emprestimo.codigo})}" class="btn btn-warning btn-sm">Editar</a>
                        <a th:if="${emprestimo.status != T(emprestimodelivro.model.SituacaoEmprestimo).FINALIZADO}"
                           th:href="@{/emprestimos/finalizar/{id}(id=${emprestimo.codigo})}"
                           class="btn btn-info btn-sm"
                           onclick="return confirm('Tem certeza que deseja finalizar este empréstimo?');">Finalizar</a>
                        <a th:href="@{/emprestimos/deletar/{id}(id=${emprestimo.codigo})}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja deletar este empréstimo?');">Deletar</a>
                    </td>
                </tr>
            </tbody>
        </table>
        <div th:if="${#lists.isEmpty(emprestimos)}">
            <p>Nenhum empréstimo registrado.</p>
        </div>
    </section>
</body>
</html>